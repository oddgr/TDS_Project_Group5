t2 = table(standard$gender)
t1
t2
prop.table(t1)
prop.table(t2)
t1 = table(peer$region)
t2 = table(standard$region)
t1
t2
prop.table(t1)
prop.table(t2)
t1 = table(peer$residence)
t2 = table(standard$residence)
t1
t2
prop.table(t1)
prop.table(t2)
t1 = table(peer$housing_status)
t2 = table(standard$housing_status)
t1
t2
prop.table(t1)
prop.table(t2)
mean(peer$duration_use)
sd(peer$duration_use)
mean(standard$duration_use)
sd(standard$duration_use)
t1 = table(peer$injecting_status)
t2 = table(standard$injecting_status)
t1
t2
prop.table(t1)
prop.table(t2)
peermentor<-read.csv(file="/Users/cirun/Desktop/HDA/istda/mini_project/peermentor.csv",header=T,sep=",")
sum(peermentor[peermentor$rehab_success == "Yes"])
sum(peermentor[peermentor$rehab_success == "Yes", ])
peermentor[peermentor$rehab_success == "Yes", ]
size(peermentor[peermentor$rehab_success == "Yes", ])
nrow(peermentor[peermentor$rehab_success == "Yes", ])
# peermentor <- peermentor[peermentor$last_obs_outcome != "LTFU", ]
peermentor <- peermentor[peermentor$injecting_status != "Missing", ]
peermentor$housing_status[peermentor$housing_status != "No problem"] <- "Have problem"
peermentor$gender <- as.factor(peermentor$gender)
peermentor$region <- as.factor(peermentor$region)
peermentor$residence <- as.factor(peermentor$residence)
peermentor$injecting_status <- as.factor(peermentor$injecting_status)
peermentor$housing_status <- as.factor(peermentor$housing_status)
peermentor$referral_source <- as.factor(peermentor$referral_source)
peermentor$rehab_success <- as.factor(peermentor$rehab_success)
peermentor$intervention <- as.factor(peermentor$intervention)
men <- peermentor[peermentor$gender == "male", ]
women <- peermentor[peermentor$gender == "female", ]
peer <-  peermentor[peermentor$intervention == "peer mentoring", ]
standard <-  peermentor[peermentor$intervention == "standard of care", ]
peermentor1 <- peermentor
peermentor1 <- peermentor1[peermentor1$injecting_status != "Missing", ]
peermentor1$injecting_status <- factor(peermentor1$injecting_status)
levels(peermentor1$injecting_status)
levels(peermentor1$rehab_success)
levels(peermentor1$injecting_status)
model1 <- glm(rehab_success ~ duration_use + injecting_status, family = binomial(link = logit), data = peermentor1)
summary(model1)
exp(model1$coefficients)
exp(confint(model1))
model2 <- glm(rehab_success ~ duration_use + injecting_status + age + gender + region + residence + intervention + housing_status, family = binomial(link = logit), data = peermentor1)
summary(model2)
exp(model2$coefficients)
exp(confint(model2))
model2 <- glm(rehab_success ~ duration_use + injecting_status + age + gender + region + residence + housing_status, family = binomial(link = logit), data = peermentor1)
summary(model2)
exp(model2$coefficients)
exp(confint(model2))
summary(peermentor$region)
peermentor2 <- peermentor
hist(peermentor2$relapse_days)
sum(is.na(peermentor2$relapse_days))
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
table(peermentor2$is_relapse)
peermentor2 <- peermentor
hist(peermentor2$relapse_days)
sum(is.na(peermentor2$relapse_days))
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
table(peermentor2$is_relapse)
View(peermentor)
View(peermentor)
View(peermentor2)
View(peermentor2)
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
View(peermentor1)
View(peermentor1)
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
peermentor2$relapse_days <- ifelse((is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed"), 720, -1)
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
#peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
peermentor2$relapse_days[is.na(peermentor2$relapse_days)] < 0.001
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
#peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
peermentor2$relapse_days[is.na(peermentor2$relapse_days)] <- 0.001
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
#peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
peermentor2$relapse_days[is.na(peermentor2$relapse_days)] <- peermentor2$last_study_obs
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
#peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
peermentor2$relapse_days[is.na(peermentor2$relapse_days)] <- peermentor2$last_study_obs[is.na(peermentor2$relapse_days)]
library(survival)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ 1, data = peermentor2)
plot(km0)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ 1, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "% Not relapse = S(t)", main = "KM model")
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ 1, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "% Not relapse = S(t)", main = "KM model", las=1)
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ 1, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "% Not relapse = S(t)", main = "KM model", las=0)
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ 1, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Proportion of not relapse = S(t)", main = "KM model")
abline(h=0.5, col="red")
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ 1, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Proportion of not relapse = S(t)", main = "KM model", mark.time = TRUE)
abline(h=0.5, col="red")
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
is_relapse
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
#peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
peermentor2$relapse_days[is.na(peermentor2$relapse_days)] <- peermentor2$last_study_obs[is.na(peermentor2$relapse_days)]
km0 <- survfit(Surv(relapse_days, is_relapse) ~ 1, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Proportion of not relapse = S(t)", main = "KM model", mark.time = TRUE)
abline(h=0.5, col="red")
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
censored = peermentor2[peermentor2$is_relapse = 0, ]
censored = peermentor2[peermentor2$is_relapse == 0, ]
View(censored)
View(censored)
summary(censored$relapse_days)
set(censored$relapse_days)
table(censored$relapse_days)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Proportion of not relapse = S(t)", main = "KM model", mark.time = TRUE)
abline(h=0.5, col="red")
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Proportion of not relapse = S(t)", main = "KM model", mark.time = TRUE)
abline(h=0.5, col="red")
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Proportion of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("blue", "green"))
abline(h=0.5, col="red")
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Proportion of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("red", "blue"))
abline(h=0.5, col="black")
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
#peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
peermentor2$relapse_days[is.na(peermentor2$relapse_days)] <- peermentor2$last_study_obs[is.na(peermentor2$relapse_days)]
View(peermentor1)
View(peermentor1)
View(peermentor2)
View(peermentor2)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Probability of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("red", "blue"))
abline(h=0.5, col="black")
legend(18, 0.95, legend = c("Peer mentor programme", "Standard of care"), lty=1, lwd=2, col = c("red", "blue"), bty="", cex=0.6)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Probability of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("red", "blue"))
abline(h=0.5, col="black")
legend(18, 0.95, legend = c("Peer mentor programme", "Standard of care"), lty=1, lwd=2, col = c("red", "blue"), bty="", cex=1)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, xlab = "Time(days)", ylab = "Probability of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("red", "blue"))
abline(h=0.5, col="black")
legend(18, 0.95, legend = c("Peer mentor programme", "Standard of care"), lty=1, lwd=2, col = c("red", "blue"), bty="", cex=0.8)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, conf.int = T, xlab = "Time(days)", ylab = "Probability of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("red", "blue"))
abline(h=0.5, col="black")
legend(18, 0.95, legend = c("Peer mentor programme", "Standard of care"), lty=1, lwd=2, col = c("red", "blue"), bty="", cex=0.8)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, conf.int = T, xlab = "Time(days)", ylab = "Probability of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("red", "blue"),  lwd=2)
abline(h=0.5, col="black")
legend(18, 0.95, legend = c("Peer mentor programme", "Standard of care"), lty=1, lwd=2, col = c("red", "blue"), bty="", cex=0.8)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, conf.int = F, xlab = "Time(days)", ylab = "Probability of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("red", "blue"),  lwd=2)
abline(h=0.5, col="black")
legend(18, 0.95, legend = c("Peer mentor programme", "Standard of care"), lty=1, lwd=2, col = c("red", "blue"), bty="", cex=0.8)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
library(rms)
install.packages(rms)
install.packages("rms")
library(rms)
## without specification
survplot(km0)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
plot(km0, conf.int = F, xlab = "Time(days)", ylab = "Probability of not relapse = S(t)", main = "KM model", mark.time = TRUE, col = c("red", "blue"),  lwd=2)
abline(h=0.5, col="black")
legend(18, 0.95, legend = c("Peer mentor programme", "Standard of care"), lty=1, lwd=2, col = c("red", "blue"), bty="", cex=0.8)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
library(rms)
## without specification
survplot(km0)
install.packages("survminer")
library("survminer")
## without specification
ggsurvplot(km0, data = peermentor2)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, color = c("red", "blue"))
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"))
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE,        # Add risk table)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata")
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.25)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.5)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time((days)")
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)")
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)", surv.median.line = "hv")
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)", surv.median.line = "hv", xlim = c(0,720))
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)", surv.median.line = "hv", xlim = c(0, 720), break.time.by = 100)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)", surv.median.line = "hv", xlim = c(0, 720), break.time.by = 120)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)", surv.median.line = "hv", xlim = c(0, 720), break.time.by = 100)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)", surv.median.line = "hv", xlim = c(0, 720), break.time.by = 100, legend.labs = c("peer mentor", "standard care"))
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
km0
#km1 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
#plot(km1)
survdiff(km0, rho=0)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
km0
survdiff(Surv(relapse_days, is_relapse) ~ intervention, rho=0)
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
km0
survdiff(Surv(relapse_days, is_relapse) ~ intervention, rho=0, data = peermentor2)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)", surv.median.line = "hv", xlim = c(0, 720), break.time.by = 100, legend.labs = c("peer mentor", "standard care"))
cox0 <- coxph(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
cox0
cox0 <- coxph(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
summary(cox0)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender, data = peermentor2)
summary(cox1)
check <- cox.zph(cox1)
check <- cox.zph(cox1)
plot(check)
check
check <- cox.zph(cox1)
check
plot(check)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status, data = peermentor2)
summary(cox1)
check <- cox.zph(cox1)
check
plot(check)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status), data = peermentor2)
summary(cox1)
check <- cox.zph(cox1)
transformed_injecting = tt(injecting_status)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status , data = peermentor2)
summary(cox1)
check <- cox.zph(cox1)
check
plot(check)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + + tt(injecting_status) + tt(region), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + + tt(injecting_status) + tt(region) + tt(age), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + + tt(injecting_status) + tt(region) data = peermentor2)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + + tt(injecting_status) + tt(region), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status * tt(injecting_status) + , data = peermentor2)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status * tt(injecting_status), data = peermentor2)
summary(cox1)
check <- cox.zph(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status) + tt(region), data = peermentor2)
summary(cox1)
check <- cox.zph(cox1, tt = function(x, t, ...) x * t)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status) + tt(region), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status, data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(region), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status) + tt(region), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status) + tt(region), data = peermentor2, tt = function(x, t, ...) x * t)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status) + tt(region), data = peermentor2, tt = function(x, t, ...) x * t)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status + tt(injecting_status) + tt(region), data = peermentor2)
summary(cox1)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status, data = peermentor2)
summary(cox1)
check <- cox.zph(cox1)
check
plot(check)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender+ residence + housing_status + duration_use + injecting_status, data = peermentor2)
summary(cox1)
check <- cox.zph(cox1)
check
plot(check)
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status, data = peermentor2)
summary(cox1)
peermentor3 <- peermentor
model4 <- lm(wellbeing1yr ~ intervention + duration_use + injecting_status + age + gender + region + residence + housing_status, data = peermentor3)
summary(model4)
confint(model4)
peermentor3 <- peermentor
relevel(peermentor3$intervention, "Standard of care")
peermentor3 <- peermentor
relevel(peermentor3$intervention, "standard of care")
model4 <- lm(wellbeing1yr ~ intervention + duration_use + injecting_status + age + gender + region + residence + housing_status, data = peermentor3)
summary(model4)
confint(model4)
peermentor3 <- peermentor
peermentor3$intervention <- relevel(peermentor3$intervention, "standard of care")
model4 <- lm(wellbeing1yr ~ intervention + duration_use + injecting_status + age + gender + region + residence + housing_status, data = peermentor3)
summary(model4)
confint(model4)
3.279696e-05
sum(peermentor[peermentor$last_obs_outcome == "LTFU",''])
View(peermentor)
View(peermentor)
sum(peermentor[peermentor$last_obs_outcome == "LTFU",])
peermentor[peermentor$last_obs_outcome == "LTFU",]
nrow(peermentor[peermentor$last_obs_outcome == "LTFU",])
peermentor<-read.csv(file="/Users/cirun/Desktop/HDA/istda/mini_project/peermentor.csv",header=T,sep=",")
nrow(peermentor[peermentor$last_obs_outcome == "LTFU",])
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
#peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
peermentor2$relapse_days[is.na(peermentor2$relapse_days)] <- peermentor2$last_study_obs[is.na(peermentor2$relapse_days)]
peermentor2$intervention <- relevel(peermentor2$intervention, "standard of care")
levels(peermentor2$intervention)
peermentor<-read.csv(file="/Users/cirun/Desktop/HDA/istda/mini_project/peermentor.csv",header=T,sep=",")
# peermentor <- peermentor[peermentor$last_obs_outcome != "LTFU", ]
peermentor <- peermentor[peermentor$injecting_status != "Missing", ]
peermentor$housing_status[peermentor$housing_status != "No problem"] <- "Have problem"
peermentor$gender <- as.factor(peermentor$gender)
peermentor$region <- as.factor(peermentor$region)
peermentor$residence <- as.factor(peermentor$residence)
peermentor$injecting_status <- as.factor(peermentor$injecting_status)
peermentor$housing_status <- as.factor(peermentor$housing_status)
peermentor$referral_source <- as.factor(peermentor$referral_source)
peermentor$rehab_success <- as.factor(peermentor$rehab_success)
peermentor$intervention <- as.factor(peermentor$intervention)
men <- peermentor[peermentor$gender == "male", ]
women <- peermentor[peermentor$gender == "female", ]
peer <-  peermentor[peermentor$intervention == "peer mentoring", ]
standard <-  peermentor[peermentor$intervention == "standard of care", ]
peermentor2 <- peermentor
peermentor2$is_relapse <- ifelse(is.na(peermentor2$relapse_days),0,1)
#peermentor2$relapse_days <- ifelse(is.na(peermentor2$relapse_days) && peermentor2$last_obs_outcome == "Study completed", 720, -1)
peermentor2$relapse_days[is.na(peermentor2$relapse_days)] <- peermentor2$last_study_obs[is.na(peermentor2$relapse_days)]
peermentor2$intervention <- relevel(peermentor2$intervention, "standard of care")
censored = peermentor2[peermentor2$is_relapse == 0, ]
km0 <- survfit(Surv(relapse_days, is_relapse) ~ intervention, data = peermentor2)
km0
survdiff(Surv(relapse_days, is_relapse) ~ intervention, rho=0, data = peermentor2)
ggsurvplot(km0, data = peermentor2, conf.int = TRUE,  pval = TRUE, palette = c("red", "blue"), risk.table = TRUE, risk.table.col = "strata", risk.table.height = 0.3, xlab = "Time(days)", surv.median.line = "hv", xlim = c(0, 720), break.time.by = 100, legend.labs = c("peer mentor", "standard care"))
cox1 <- coxph(Surv(relapse_days, is_relapse) ~ intervention + age + gender + region + residence + housing_status + duration_use + injecting_status, data = peermentor2)
summary(cox1)
model2 <- glm(rehab_success ~ duration_use + injecting_status + age + gender + region + residence + housing_status, family = binomial(link = logit), data = peermentor1)
library(survival)
peermentor<-read.csv(file="/Users/cirun/Desktop/HDA/istda/mini_project/peermentor.csv",header=T,sep=",")
str(peermentor)
summary(peermentor)
# peermentor <- peermentor[peermentor$last_obs_outcome != "LTFU", ]
peermentor <- peermentor[peermentor$injecting_status != "Missing", ]
peermentor$housing_status[peermentor$housing_status != "No problem"] <- "Have problem"
peermentor$gender <- as.factor(peermentor$gender)
peermentor$region <- as.factor(peermentor$region)
peermentor$residence <- as.factor(peermentor$residence)
peermentor$injecting_status <- as.factor(peermentor$injecting_status)
peermentor$housing_status <- as.factor(peermentor$housing_status)
peermentor$referral_source <- as.factor(peermentor$referral_source)
peermentor$rehab_success <- as.factor(peermentor$rehab_success)
peermentor$intervention <- as.factor(peermentor$intervention)
men <- peermentor[peermentor$gender == "male", ]
women <- peermentor[peermentor$gender == "female", ]
peer <-  peermentor[peermentor$intervention == "peer mentoring", ]
standard <-  peermentor[peermentor$intervention == "standard of care", ]
# peermentor <- peermentor[peermentor$last_obs_outcome != "LTFU", ]
peermentor <- peermentor[peermentor$injecting_status != "Missing", ]
peermentor$housing_status[peermentor$housing_status != "No problem"] <- "Have problem"
peermentor$gender <- as.factor(peermentor$gender)
peermentor$region <- as.factor(peermentor$region)
peermentor$residence <- as.factor(peermentor$residence)
peermentor$injecting_status <- as.factor(peermentor$injecting_status)
peermentor$housing_status <- as.factor(peermentor$housing_status)
peermentor$referral_source <- as.factor(peermentor$referral_source)
peermentor$rehab_success <- as.factor(peermentor$rehab_success)
peermentor$intervention <- as.factor(peermentor$intervention)
men <- peermentor[peermentor$gender == "male", ]
women <- peermentor[peermentor$gender == "female", ]
peer <-  peermentor[peermentor$intervention == "peer mentoring", ]
standard <-  peermentor[peermentor$intervention == "standard of care", ]
t1 = table(peer$injecting_status)
t2 = table(standard$injecting_status)
t1
t2
prop.table(t1)
prop.table(t2)
peermentor1 <- peermentor
peermentor1 <- peermentor1[peermentor1$injecting_status != "Missing", ]
peermentor1$injecting_status <- factor(peermentor1$injecting_status)
levels(peermentor1$rehab_success)
levels(peermentor1$injecting_status)
model1 <- glm(rehab_success ~ duration_use + injecting_status, family = binomial(link = logit), data = peermentor1)
summary(model1)
exp(model1$coefficients)
exp(confint(model1))
model2 <- glm(rehab_success ~ duration_use + injecting_status + age + gender + region + residence + housing_status, family = binomial(link = logit), data = peermentor1)
summary(model2)
exp(model2$coefficients)
exp(confint(model2))
library(data.table)
mydata=data.frame(fread("./test_data.csv", nrows=5))
getwd()
setwd('/Users/cirun/Desktop/TDS_Project_Group5/')
mydata=data.frame(fread("test_data.csv", nrows=5))
View(mydata)
View(mydata)
myfields=unname(unlist(read.table("to_extract.txt", header=FALSE)))
myfields
column_id=grep("eid", colnames(mydata))
column_id
colnames(mydata)
View(mydata)
found_fieldids=NULL
for (k in 1:length(myfields)){
mygrep=grep(paste0("X",myfields[k],"."), fixed=TRUE, colnames(mydata))
if (length(mygrep)>0){
found_fieldids=c(found_fieldids, myfields[k])
}
column_id=c(column_id, mygrep)
}
column_id
extracted=data.frame(fread("test_data.csv", select=column_id)) # Path to change!
View(extracted)
myfields
View(mydata)
View(mydata)
mydata=data.frame(fread("test_data.csv", nrows=5))
View(mydata)
View(mydata)
mydata=data.frame(fread("test_data.csv", nrows=5))
myfields=unname(unlist(read.table("to_extract.txt", header=FALSE)))
# Extracting the column ids
column_id=grep("eid", colnames(mydata))
found_fieldids=NULL
for (k in 1:length(myfields)){
mygrep=grep(paste0("X",myfields[k],"."), fixed=TRUE, colnames(mydata))
if (length(mygrep)>0){
found_fieldids=c(found_fieldids, myfields[k])
}
column_id=c(column_id, mygrep)
}
# Extracting required columns from dataset
extracted=data.frame(fread("test_data.csv", select=column_id)) # Path to change!
View(extracted)
View(extracted)
mydata=data.frame(fread("test_data.csv", nrows=5))
mydata=data.frame(fread("test_data.csv", nrows=5))
mydata=data.frame(fread("test_data2.csv", nrows=5))
View(mydata)
View(mydata)
